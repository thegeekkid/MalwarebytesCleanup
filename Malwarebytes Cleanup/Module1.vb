Imports System.IO
Module Module1
    'After how many days should you delete the log files?
    Dim thresh As Integer = 30
    Sub Main(ByVal args() As String)
        Try
            If args.Length > 0 Then
                If IsNumeric(args(0)) Then
                    thresh = args(0)
                Else
                    Console.WriteLine("Error: threshold must be a integer.  Using default value of 30.")
                End If
            End If
            searchlogs("C:\ProgramData\Malwarebytes\Malwarebytes' Anti-Malware\Logs\", ".txt")
            searchlogs("C:\ProgramData\Malwarebytes\Malwarebytes' Anti-Malware\Logs\", ".xml")
            searchlogs("C:\ProgramData\Malwarebytes Anti-Exploit\Logs\", ".log")
        Catch ex As Exception
            Console.WriteLine("Critical execution error:")
            Console.WriteLine(ex.ToString)
        End Try
    End Sub

    Private Sub searchlogs(ByVal path As String, ByVal extension As String)
        Try
            Console.WriteLine("Cleaning " & path & " of " & extension & " files that are older than " & thresh & "days.")
            For Each file As String In Directory.GetFiles(path)
                If file.EndsWith(extension) Then
                    If getdate(file) < My.Computer.Clock.LocalTime.Date.AddDays(-thresh) Then
                        Console.WriteLine("Deleting " & file)
                        Try
                            My.Computer.FileSystem.DeleteFile(file)
                        Catch ex As Exception
                            Console.WriteLine("Error: couldn't delete " & file & ".")
                            Console.WriteLine(ex.ToString)
                        End Try
                    End If
                End If
            Next
            Console.WriteLine("Finished cleaning " & path & ".")
        Catch ex As Exception
            Console.WriteLine("CRITICAL ERROR: Could not finish cleaning " & path & ".")
            Console.WriteLine(ex.ToString)
        End Try

    End Sub
    Public Function getdate(ByVal file As String) As String
        If My.Computer.FileSystem.FileExists(file) Then
            Dim inforeader As IO.FileInfo
            inforeader = My.Computer.FileSystem.GetFileInfo(file)
            Return inforeader.LastWriteTime
        Else
            'File doesn't exist, return a placeholder that no one will believe.
            Return "1/1/3035 12:00:00 AM"
        End If
    End Function
End Module
